{
  "meta": {
    "action_name": "推举 (配置驱动版)",
    "version": "V1.0",
    "description": "包含耸肩检测(相对论算法)与小臂垂直检测"
  },
  
  "styles": {
    "default": "#AAFFFFFF",
    "good": "#00E676",
    "bad": "#FF1744"
  },

  "virtual_points": [
    {
      "id": 101, "name": "shoulder_mid", "calc": "midpoint", "sources": [11, 12]
    },
    {
      "id": 102, "name": "wrist_mid", "calc": "midpoint", "sources": [15, 16]
    },
    {
      "id": 103, "name": "left_elbow_target", "calc": "projection_vertical", "source": 13, "offset_y": -150
    },
    {
      "id": 104, "name": "right_elbow_target", "calc": "projection_vertical", "source": 14, "offset_y": -150
    }
    ,{
      "id": 105, "name": "left_shoulder_above", "calc": "offset", "source": 11, "offset_y": -60
    },
    {
      "id": 106, "name": "right_shoulder_above", "calc": "offset", "source": 12, "offset_y": -60
    },
    {
      "id": 107, "name": "left_wrist_proj", "calc": "compose", "source_x": 13, "source_y": 15
    },
    {
      "id": 108, "name": "right_wrist_proj", "calc": "compose", "source_x": 14, "source_y": 16
    }
  ],

  "dynamic_vars": [
    {
      "name": "shrug_baseline",
      "comment": "站立放松时的鼻肩垂直距离 (最大值)",
      "source_type": "distance_y",
      "points": [101, 0], 
      "update_mode": "max_hold_damped",
      "damping": 0.05,
      "decay": 0.9995,
      "active_state": "START"
    }
  ],

  "elements": [
    // --- 小臂垂直辅助线 (始终显示) ---
    {
      "type": "line", "from": 13, "to": 103, "width": 2, "is_dashed": true, "style_key": "good"
    },
    {
      "type": "line", "from": 14, "to": 104, "width": 2, "is_dashed": true, "style_key": "good"
    },
    {
      "type": "circle", "center": 103, "radius": 8, "style_key": "good"
    },
    {
      "type": "circle", "center": 104, "radius": 8, "style_key": "good"
    },

    // --- 耸肩特效 (P2) ---
    {
      "condition_ref": "shrug",
      "on_good": { "type": "icon", "icon_name": "check", "center": 11, "style_key": "good" },
      "on_bad": { "type": "arrow", "start": 105, "direction": [0, 1], "style_key": "bad", "anim": "bounce", "len": 40, "gap": 0 }
    },
    {
      "condition_ref": "shrug",
      "on_good": { "type": "icon", "icon_name": "check", "center": 12, "style_key": "good" },
      "on_bad": { "type": "arrow", "start": 106, "direction": [0, 1], "style_key": "bad", "anim": "bounce", "len": 40, "gap": 0 }
    },

    // --- 小臂垂直特效 (P1) ---
    {
      "condition_ref": "arm",
      "on_bad": { "type": "arrow", "from": 15, "to": 107, "style_key": "bad", "gap": 20 }
    },
    {
      "condition_ref": "arm",
      "on_bad": { "type": "arrow", "from": 16, "to": 108, "style_key": "bad", "gap": 20 }
    }
  ],

  "evaluation": {
    "logic_control": {
      "display_mode": "exclusive",
      "sort_order": "priority_asc"
    },

    "state_machine": {
      "trigger_down": {
        "metric": "vertical_diff",
        "points": [0, 102], // 鼻 - 手腕中点
        "threshold": 50,    // 鼻子比手腕高 50px (即手腕在鼻子下方 50px 以上? 不对，Y向下大)
        // 逻辑修正：
        // Start -> Down (举起): 手腕(102) Y < 鼻子(0) Y - 50
        // 即 0.y - 102.y > 50
        // vertical_diff(0, 102) > 50
        "operator": ">"
      },
      "trigger_up": {
        "metric": "vertical_diff",
        "points": [0, 102],
        "threshold": 0, // 手腕回到鼻子下方 (0.y - 102.y < 0)
        "operator": "<"
      },
      "zombie_breaker": {
        "timeout_sec": 5.0,
        "reset_condition": {
          "metric": "vertical_diff",
          "points": [0, 102],
          "threshold": -100, // 手腕远低于鼻子
          "operator": "<"
        }
      }
    },

    "conditions": [
      {
        "id": "arm",
        "comment": "小臂垂直检测",
        "priority": 1,
        "type": "angle_vertical",
        "points": [[15, 13], [16, 14]], // [左腕, 左肘], [右腕, 右肘]
        "max": 20.0,
        "correction_mode": "latch_fail" // [Fix] 一票否决模式
      },
      {
        "id": "shrug",
        "comment": "耸肩检测 (相对论)",
        "priority": 2,
        "type": "ratio_vertical_dynamic",
        "points": [101, 0], // 肩中点 - 鼻
        "baseline_var": "shrug_baseline",
        // 逻辑：
        // 耸肩 -> 肩膀上提 -> 肩鼻距离变小 -> ratio 变小
        // 假设阈值 0.2 (压缩20%) -> ratio < 0.8 是坏的
        // ratio_vertical_dynamic 默认检查 max (过大是坏)
        // 这里我们需要检查 min (过小是坏)
        "min": 0.80, 
        "correction_mode": "latch_fail", // [Fix] 一票否决模式
        "correction_constraint": {
           // 仅在手举起来时检测耸肩
           "metric": "vertical_diff",
           "points": [0, 102], // 鼻 - 手腕
           "threshold": 0, // 手腕高于鼻子时
           "operator": ">"
        }
      }
    ]
  }
}