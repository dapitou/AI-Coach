# 全局通用逻辑：

## 优先级定义：
- 选项/权重：P0 ＞ P1 ＞ P2
- 触发：错误同时触发时，优先高的触发
- 挤占：不可挤占（某种动作纠错状态中，触发其他任何优先级的纠错都不挤占当前纠错，直到该纠错状态解除）

# 纠错项逻辑配置：
## 基本信息：
- **标识**：
  - ID：唯一标识符
  - 名称：显示名称（如 `膝内扣`）
  - 描述：详细说明（如 `检测下蹲过程中双膝是否内扣`）
- **属性**：
  - 优先级：P0 | P1 | P2
  - 算法类型：关联的判定算法类型（如 `ratio_width`, `angle_vertical`）

## 关键点配置：
- **类型**：原生骨骼点 | 虚拟计算点
- **原生骨骼点**：
  - ID：模型原始ID
  - 名称：标准骨骼名称（如 `nose`, `left_shoulder`）
- **虚拟计算点**：
  - ID：自定义唯一ID
  - 名称：自定义名称（如 `hip_mid`）
  - 运算器：
    - `midpoint`（中点）：输入 [点A, 点B...]
    - `projection`（投影）：输入 [源点] + 偏移量（如垂直投影）
    - `offset`（偏移）：输入 [源点] + (x, y)偏移量
    - `compose`（组合）：输入 [点A(取x), 点B(取y)]

## 动态基准配置：
- **说明**：定义用于计算压缩率或相对位置的参考基准值
- **基本属性**：
  - 名称：变量名
  - 采集源：点对距离 | 点坐标
- **采集逻辑**：
  - 算法：`智能基准校准`
  - 机制：自动在`准备`状态下采集最大值，并应用阻尼抗噪和微量衰减
  - 参数：
    - 阻尼：默认 0.05 (抗噪)
    - 衰减：默认 0.9995 (防止虚高)

## 判定指标配置：
- **枚举**：角度 | 比例 | 距离 | 共线
- **角度**：
  - 说明：计算关键点构成的几何夹角
  - 定义：2-4个点（如 3点求夹角，2点求与水平/垂直夹角）
  - 属性：内角 | 外角
- **比例**：
  - 说明：计算两组线段长度的比值（如膝宽/髋宽）
  - 定义：分子线段（点A-点B） / 分母线段（点C-点D）
- **距离/压缩率**：
  - 说明：计算动态距离相对于基准值的变化率
  - 定义：测量点对（点A-点B）
  - 公式：压缩率 = 当前距离 / 动态基准值
- **共线/偏移**：
  - 说明：检测关键点是否偏离基准直线（如弓背、侧倾）
  - 定义：基准线（起点-终点），目标点
  - 公式：偏移率 = 点到直线距离 / 基准线长度

## 状态机配置：
- 准备：判定指标、运算器
- 向心（发力）：判定指标、运算器
- 离心（还原）：判定指标、运算器
- 保持（静力）：判定指标、时长阈值（新增，用于平板支撑等）
- 复位：判定指标、运算器
- 纠错区间：判定指标、运算器
- 超时熔断：熔断时长；判定指标、运算器

## 纠错标准配置：
- 通用参数：
  - **逻辑关系**：AND | OR （支持多指标组合触发）
  - **时序防抖**：触发帧数（Trigger Frames）、释放帧数（Release Frames）
- 指标参数：
  - 角度：运算器（＞等）；角度（°）；容忍度（±°）
  - 比例：运算器（＞等）；比例；容忍度（±比例）
  - 距离：运算器（＞等）；压缩率（%）；容忍度（±%）
  - 共线：运算器（＞等）；偏移量（%）；容忍度（±%）

## 动力链配置：
- 说明：用于检测复合动作中多个关节/部位的协同运动关系（非必填）
- 选项：同步型 | 顺序型
- 动力链类型：
  - 同步型：
    - 定义：标准A与标准B在动作过程中需保持协同变化（线性关系）
    - 逻辑：|标准A - (标准B * 系数 + 偏移)| ≤ 容忍度
    - 示例：硬拉（伸膝角度 vs 伸髋角度，需同步展开）
  - 顺序型：
    - 定义：标准A必须先于标准B达到特定阈值
    - 逻辑：当标准B未触发时，指标A必须已触发
    - 示例：深蹲（先屈髋后屈膝 vs 先屈膝后屈髋）

## 单双侧定义：
- 选项：触发（单侧 | 双侧）；解除（单侧 | 双侧）
- 触发：单侧，任一侧不达标触发；双侧，双侧均不达标触发
- 解除：单侧，任一侧达标解除；双侧，双侧均达标解除

## 纠错判定配置：
- 选项：一票否决 | 达成即过 | 严格修正 | 实时跟随
- 类型：
  - **一票否决**：
    - 错误触发：本次循环初始“合格”，动作全程中只要出现错误（满足防抖帧数），本次循环即刻判”不合格“并锁定
    - 错误解除：不可解除（本轮动作已判负，需等待下一轮重置），下一轮全程“合格”解除
    - 场景：动作标准类，需要全程保持正确的动作
    - 示例：小臂不垂直（推肩）；耸肩（推肩）
  - **达成即过**：
    - 错误触发：本次循环初始“合格”，动作纠错区内只要未达到标准，本次循环判”不合格“
    - 错误解除：本次循环初始“不合格”，动作纠错区内只要达到标准，本次循环判”合格“
    - 场景：动作幅度类，需要特定关键帧区间动作幅度达标的动作
    - 示例：下蹲深度不足（深蹲）、抬肘高度不足（侧平举）
  - **严格修正**：
    - 错误触发：本次循环初始“合格”，动作纠错区内只要出现错误，本次循环判”不合格“
    - 错误解除：本次循环初始“不合格”，动作纠错区内修正错误，并一直保持直离开纠错区，本次循环判”合格“
    - 场景：动作标准类，需要特定关键帧区间保持正确动作
    - 示例：膝内扣（深蹲）；膝内扣（弓步）
  - **实时跟随**：
    - 逻辑：无记忆。当前帧是对就是对，错就是错，状态随动作实时跳变。
    - 场景：待定
    - 示例：待定

## 纠错交互
## 重心侧倾（通用）
> 描述：动作底峰，躯干重心（双肩双髋）偏离身体中轴（双脚中点垂线）
- **关键点**：
  - 坐标：点
  - 样式：样式（正确/错误）
- **目标点**：
  - 坐标：点
  - 样式：样式（正确/错误）
- **关键线**：
  - 起点：点
  - 终点：点
  - 方向：点 → 点 | 水平 | 垂直
  - 样式：样式（正确/错误）
- **目标线**：
  - 起点：点
  - 终点：点
  - 方向：点 → 点 | 水平 | 垂直
  - 样式：样式（正确/错误）
- **引导**：
  - 起点：点
  - 终点：点
  - 方向：点 → 点 | 水平 | 垂直
  - 样式：样式（正确/错误）
  - 功能：-
- **提示词**：“xxx”