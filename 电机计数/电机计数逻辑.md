![alt text](image.png)

1. 静止判断：
拉动范围 ≤ ±5cm：静止（包含轻微抖动）
拉动范围 ＞ ±5cm：拉动

*抖动定义：
持续 ＞ 300ms，且范围 ±3-5cm。仅用于标记状态，不影响趋势判断与计次

2. 趋势判断：
趋势类型：向心/离心/静止
动作静止 ≤ 3s：趋势继续
动作静止 ＞ 3s：趋势改变

3. 单/双侧判断（初始）：
- 初始，基于趋势变化点：
向心双侧：向心启动/结束时间差 ≤ 0.2s
向心单侧：向心启动/结束时间差 ＞0.2s
离心双侧：离心启动/结束时间差 ≤ 0.2s
离心单侧：离心启动/结束时间差 ＞0.2s
- 起点/行程初始化后，基于计次线
* 缓冲区（0.15s~0.25s）防止误判

4. 动作初始化：
起点和行程均满足以下条件
- 起点初始化：
邻近2次向心起点相似（≤20%）
- 行程初始化：
邻近2次向心行程相似（≤20%）
（单侧取单侧，双侧取均值）
*相似≤20%：相邻两次差值/前一次值 * 100% ≤ 20%
行程未确认时：
首次暂停1.5s重置起点和行程
非首次暂停3s重置起点和行程
当初始行程已确认时：
暂停不重置起点和行程
起点容差：± 10cm

5. 计次初始化：
动作初始化未完成：Loading
动作初始化完成：计次+2（补记1次）

6. 计次线：
- 向心计次线：
起点+80%行程
- 离心计次线：
起点+20%行程
行程初始化完成时确认

7. 计次逻辑：（默认向心计次线，动作库支持配置）
- 全局：
起点偏差（当前起点与初始起点）＞20%：不计次
起点偏差≤20%且满足以下条件计次：
- 手柄模式：
向心同时过线（≤0.2s）：双侧计次共+1
向心非同时过线（＞0.2s）：单侧分别计次+1
向心未过线：不计次
- 横杆模式：
向心同时过线（≤0.2s）：计次+1
向心非同时过线：不计次
向心未过线：不计次
* 缓冲区（0.15s~0.25s）防止误判

8. 动作修正：（动作库支持开关此逻辑）
满足以下任意条件，对应的起点/行程同时修正
- 起点修正：
最近相邻2次向心起点均偏离当前起点＞20%，且互相相似（≤20%）
- 行程修正：
最近相邻2次向心行程均未达到当前计次线，且互相相似（≤20%）
*相似≤20%：相邻两次差值/前一次值 * 100% ≤ 20%

- 计次线修正：
起点/行程修正时更新
- 计次修正：
起点/行程修正时：计次+2（补记1次）