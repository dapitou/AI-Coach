# AI推荐_智能版_用户故事 (User Stories)

> **版本**：V28.0
> **背景**：基于“AI推荐完整定义”与“AI推荐Demo”逻辑。
> **预设角色**：**存量用户 (Alex)**
> - **状态**：已注册，拥有基础身体数据（身高/体重/性别），但未填写新版核心字段（如功能目标、主观疲劳度）。
> - **场景**：希望利用AI教练生成个性化的训练内容。

---

## 1. 智能冷启动与档案完善 (Smart Cold Start)

### 需求 1.1：关键档案缺失引导
**用户故事：**
作为一名老用户，当我尝试使用“给我一节课”或“给我一份计划”功能时，如果我的档案中缺少生成算法必须的“功能目标”或“主观疲劳度”数据，我希望系统能自动引导我补充，而不是直接报错，以便我能顺畅地使用新功能。

#### 验收标准 (Acceptance Criteria)
1.  **触发拦截**：当用户点击首页“给我一节课/计划”按钮时，系统应立即校验 `User.funcGoal` (功能目标) 字段。
2.  **自动跳转**：若字段缺失，系统应弹出提示“请更新运动档案”，并自动打开档案编辑模态框。
3.  **视觉引导**：在档案编辑页中，缺失的关键字段（如“目标”Tab下的功能目标）应有明显的红点或高亮提示。
4.  **数据联动**：用户补充“功能目标”（如：力量）并保存后，系统应自动更新首页的“档案卡片”展示，并允许用户重新进入生成流程。

### 需求 1.2：主观疲劳度录入与反馈
**用户故事：**
作为一名用户，我希望在开始训练前能快速录入我当天的“主观疲劳度”，并看到系统对该状态的评估，以便AI能根据我的状态调整训练强度。

#### 验收标准
1.  **交互形式**：在档案卡片或课前问询中，提供 1-10 的滑动条供用户打分。
2.  **实时反馈**：
    *   当滑块在 1-2 时，显示“已恢复”（绿色），提示“强度系数: 1.0”。
    *   当滑块在 6-7 时，显示“疲劳中”（黄色），提示“强度系数: 0.8”。
    *   当滑块在 8-10 时，显示“已力竭”（红色），提示“建议休息”。
3.  **算法影响**：录入的疲劳度应直接写入 `Context.status.fatigue`，用于后续课程生成的降级判断。

---

## 2. 多模态意图识别 (Multimodal Intent)

### 需求 2.1：自然语言意图解析
**用户故事：**
作为一名用户，我希望通过语音直接告诉AI“我想练胸肌，大概30分钟”，系统能自动识别我的需求并填充选项，而不需要我手动一步步点击。

#### 验收标准
1.  **实体提取**：系统应能从语音流中提取“胸部”（目标部位）、“30分钟”（时长）等关键词。
2.  **自动填充**：识别成功后，对话框中的对应选项（如部位Tag、时长滑块）应自动变为选中/设定状态。
3.  **确认机制**：若语音包含明确的确认指令（如“就这样”、“确认”），系统应自动进入下一步；否则等待用户手动确认。
4.  **模糊匹配**：当用户说“练练腿”时，系统应能自动匹配到“腿部”选项；说“半小时”能匹配到“30分钟”。

### 需求 2.2：智能风控与疲劳干预
**用户故事：**
作为一名用户，如果我昨天刚练过腿或者今天腿部很累，但我又要求“练腿”，我希望AI能发出警告并提供替代方案，防止我过度训练受伤。

#### 验收标准
1.  **风险检测**：在用户确认“目标部位”时，系统应校验该部位是否在 `User.fatiguedParts` 或 `User.pain` 列表中。
2.  **中断交互**：若检测到风险（如胸部疲劳），对话流应暂停，AI气泡回复“检测到胸部尚未恢复，建议改练背部”。
3.  **决策分支**：提供两个选项供用户选择：
    *   **“切换为背部”**：点击后自动修改目标为推荐部位，并继续流程。
    *   **“坚持练胸部”**：点击后保留原目标，但系统在后台标记 `downgrade=true`（触发后续的强度降级）。

---

## 3. 运动处方生成与微调 (Prescription & Fine-tuning)

### 需求 3.1：推理过程可视化 (Explainable AI)
**用户故事：**
作为一名用户，在AI生成课程的几秒钟等待时间里，我希望能看到AI在做什么（比如“正在匹配策略”、“正在筛选动作”），这会让我觉得生成的方案更专业、更可信。

#### 验收标准
1.  **日志展示**：在生成过程中，界面应逐行显示决策日志（如：读取档案 -> 风控扫描 -> 策略匹配 -> 构建课程）。
2.  **动态效果**：配合Siri式的呼吸灯动效，展示AI的“思考”状态。

### 3.2：课程结构与负荷策略微调
**用户故事：**
作为一名进阶用户，我希望在AI生成课程后，能手动调整训练的“负荷策略”（比如从恒定重量改为递增组），系统应能自动帮我重新计算每一组的重量。

#### 验收标准
1.  **策略切换**：在课程详情页，用户可将环节的负荷策略在“推荐/恒定/递增/递减”之间切换。
2.  **锚点重算**：
    *   切换至**“递增”**：系统应以当前最大重量为最后一组，向前递减计算前几组重量。
    *   切换至**“恒定”**：系统应将所有组的重量统一为当前最大重量。
3.  **RM联动**：当重量发生变化时，系统应基于用户的 `1RM` 数据，自动反推并更新建议的 `Reps`（次数），确保强度合理。

### 3.3：动作替换与器械适配
**用户故事：**
作为一名用户，如果生成的课程里有我不喜欢的动作（或者我没有对应的器械），我希望通过“替换”功能换一个同部位、同功能的其他动作。

#### 验收标准
1.  **上下文保持**：点击替换时，动作库应默认筛选当前动作的“部位”和“功能”（如：胸部+增肌）。
2.  **智能筛选**：动作库列表应自动置灰或隐藏用户“缺失配件”的动作。
3.  **无缝回填**：选择新动作后，新动作应继承原动作的槽位属性（如组数），并根据新动作的属性重新计算负荷（如：杠铃卧推换成哑铃卧推，重量应自动降低）。

---

## 4. 周期计划生成 (Periodization Plan)

### 需求 4.1：基于周期的阶段划分
**用户故事：**
作为一名用户，当我制定一个4周的增肌计划时，我希望看到计划被科学地划分为不同阶段（如适应期、进阶期），而不是每周都一样。

#### 验收标准
1.  **阶段可视**：计划详情页应展示阶段流程图（如：第1周适应期 -> 第2-3周进阶期 -> 第4周减载期）。
2.  **参数差异**：点击不同阶段，应能看到该阶段的训练侧重变化（如：进阶期强度系数1.0，减载期强度系数0.6）。
3.  **体重预测**：系统应根据计划的强度和周期，生成一张体重/体脂变化的预测趋势图。

### 需求 4.2：周历排课与冲突处理
**用户故事：**
作为一名用户，我希望计划能自动避开我设置的“休息日”，并将课程填充到我有空的“训练日”里。

#### 验收标准
1.  **日程映射**：生成的周历应严格匹配用户档案中的“每周训练日”（如用户只选了周一/三/五，则周二/四/六/日必须为休息）。
2.  **模板适配**：系统应根据用户的周频（如3练），自动选择匹配的模板（如“三分化”或“全身循环”），而不是生硬地截断课程。

---

## 5. 沉浸式训练执行 (Execution)

### 需求 5.1：力量模组控制 (Weight Dial)
**用户故事：**
作为一名使用AEKE力量镜的用户，在做力量动作时，我希望能直接在屏幕上通过拖动“表盘”来快速调整电机的输出重量，而不需要按物理按钮。

#### 验收标准
1.  **表盘交互**：训练界面应显示圆环状重量表盘，支持拖拽调节。
2.  **精度控制**：重量调节精度应符合配置（如 KG模式0.5kg步进）。
3.  **实时生效**：调节后的重量应立即同步给底层硬件控制模块（Demo中体现为数值更新）。

### 5.2：实时数据反馈
**用户故事：**
作为一名用户，在做动作过程中，我希望看到实时的功率曲线和行程曲线，以便我知道自己发力是否平稳、动作幅度是否达标。

#### 验收标准
1.  **波形图表**：界面应包含“实时功率”和“行程曲线”两个动态图表。
2.  **左右区分**：对于双侧/单侧动作，图表应能区分或合并显示左右侧的数据（Demo中通过模拟键 Z/C 触发左右侧数据）。
3.  **峰值记录**：系统应记录每一组的峰值功率，并在组间休息或结算时用于分析。

### 5.3：循环组/超级组执行逻辑
**用户故事：**
作为一名用户，当课程安排了“循环组”（Circuit）时，我希望系统能引导我做完动作A的一组后，直接跳到动作B的一组，而不是把动作A全做完。

#### 验收标准
1.  **跳转逻辑**：
    *   **常规组**：完成 Set 1 -> 休息 -> Set 2。
    *   **循环组**：完成 动作A Set 1 -> 换项休息 -> 动作B Set 1。
2.  **休息类型**：
    *   动作切换时显示“组间休息/换项休息”。
    *   大轮次结束时显示“轮间休息”（通常时间更长）。
3.  **UI指引**：动作列表浮层应清晰展示当前的执行顺序（横向跳转 vs 纵向跳转）。

---

## 6. 动作库管理 (Action Library)

### 需求 6.1：多维筛选与详情查看
**用户故事：**
作为一名用户，在浏览动作库时，我希望能通过“部位”、“器械”、“难度”等多个条件组合筛选动作，并能看到动作的详细肌肉参与图。

#### 验收标准
1.  **组合筛选**：支持同时选中“胸部” + “哑铃” + “L3”进行筛选。
2.  **详情展示**：点击动作应弹出详情页，展示：
    *   **视频**：标准演示视频。
    *   **肌群**：高亮显示主动肌（红色）、辅助肌（黄色）。
    *   **属性**：冲击等级、代谢当量(MET)、是否为复合动作。

<!--
[PROMPT_SUGGESTION]请根据更新后的用户故事，检查 view-workout.js 中的 finishSet 函数，确认循环组(Circuit)的跳转逻辑是否完全符合需求 5.3 的验收标准。[/PROMPT_SUGGESTION]
[PROMPT_SUGGESTION]请基于需求 1.2，为我生成一段 logic.js 代码，用于在生成课程时根据 User.fatigue (1-10) 动态调整主训环节的强度系数和容量系数。[/PROMPT_SUGGESTION]
-->