# 重量推荐逻辑
> > *业务导读：智能计算每次训练该用多大重量的算法核心。*
> **定义**：基于运动科学（1RM推算、VBT速度训练、遗忘曲线）的智能负荷管理中心。
> **用途**：为课程生成提供初始重量，并在训练执行中提供动态重量调整推荐。

## 一、 初始负荷推荐
> **场景**：用户开始做某动作的第一组（或热身组）时，系统给出的建议重量。
> > *业务导读：第一次做这个动作该用多重？有历史看历史，没历史靠测评推算，实在不行走兜底，确保起步安全。*

### 1.1 新动作
> > *业务导读：没做过的动作，靠测评数据推算或者用默认值兜底，保证有数可依。*
> **定义**：用户从未做过该动作，或该动作无历史1RM数据。
> **逻辑核心**：基于“部位能力测评”进行跨动作推算；若无测评则走兜底逻辑。

#### A. 基于测评推算 (优先)
> > *业务导读：利用测评数据，通过肌肉系数推算出新动作的合适重量。*
> **条件**：用户拥有该动作对应部位的有效 `测评1RM` 数据。
> **映射规则**：动作库 "臀部" 和 "腿部" 共用测评中 "臀腿" 的 1RM。
> **公式**：
> `第一组重量 = 部位测评1RM(最新) × 肌肉系数(全局配置) × 目标次数RM百分比`
> *注：肌肉系数基于动作的[主动肌]字段，查阅附录[肌肉系数映射表]*

#### B. 兜底逻辑 (无测评)
> > *业务导读：如果没有测评数据，根据默认值或历史记录给出一个安全的起始重量。*
> **条件**：用户无对应部位测评数据。
> **场景1：首次执行 (User First)**
> - **热身组**：`1.0 × 基础力`
> - **正式组**：`1.0 × 基础力`
>
> **场景2：非首次执行 (User History)**
> - *定义*：无1RM记录，但有历史执行记录 (记忆重量)。
> - **热身组**：`0.6 × 记忆重量`
> - **正式组**：`1.0 × 记忆重量`

#### C. 下限限制
> > *业务导读：确保推荐的重量不低于设备的最小调节范围。*
> **规则**：计算结果若低于下限，取下限值。
> - **公斤 (kg)**：2 kg
> - **磅 (lbs)**：4 lbs

### 1.2 旧动作 (有1RM记录)
> > *业务导读：做过的动作，根据历史记录和遗忘曲线（多久没练）来调整重量。*
> **定义**：该动作存在历史 1RM 记录。
> **逻辑核心**：基于遗忘曲线（上次训练时间）对历史能力进行衰减修正。

#### A. 衰减系数 (遗忘曲线)
> > *业务导读：根据你多久没练，计算力量衰退了多少。*
| 距上次训练时间 | 系数 | 说明 |
| :--- | :--- | :--- |
| **≤ 14天** | **1.00** | 能力保持 |
| **14 - 28天** | **0.95** | 轻微衰退 (-5%) |
| **≥ 28天** | **0.90** | 显著衰退 (-10%) |

#### B. 推荐公式
> > *业务导读：结合历史记录和衰减系数，计算出今天的推荐重量。*
> **热身组**：
> `重量 = 60% × 动作最新1RM × 目标次数RM百分比 × 衰减系数`
>
> **正式组 (第一组)**：
> `重量 = 100% × 动作最新1RM × 目标次数RM百分比 × 衰减系数`

---

## 二、 过程负荷调节
> **场景**：组间休息时，基于上一组的表现（速度/感受/完成度），动态调整下一组重量。
> **核心逻辑**：`下一组重量 = 上一组重量 × (1 + 调整百分比)`
> > *业务导读：组间休息时，看你上一组做得快不快、累不累，动态调整下一组的重量，像真人教练一样盯着你。*

### 2.1 基于速度与感受
> > *业务导读：动作做得太快说明轻了，太慢说明重了，实时调整下一组重量。*
> **前提**：硬件支持获取向心速度 (Velocity)。
> **限制**：仅适用于 `动作功率` = "普通" 的常规力量动作。

| 基础维度 | 状态评价 | 判定条件 (VBT优先) | 下一组调整 |
| :--- | :--- | :--- | :--- |
| **重量感受** | **很轻** | Rep2-5 平均速度 ≥ 1.0 m/s | **+10%** |
| (含≤5次场景) | **略轻** | 0.5 m/s ≤ Rep2-5 平均速度 < 1.0 m/s | **+5%** |
| | **中等** | 0.3 m/s ≤ Rep2-5 平均速度 < 0.5 m/s | **保持 (0%)** |
| | **略重** | 0.2 m/s ≤ Rep2-5 平均速度 < 0.3 m/s | **-5%** |
| | **很重** | Rep1-5 平均速度 < 0.2 m/s | **-10%** |

### 2.2 基于疲劳程度
> > *业务导读：如果速度掉得太厉害，说明累了，下一组得降重。*
> **逻辑**：对比最后一组与初始状态的速度衰减。

| 状态评价 | 判定条件 (速度衰减率) | 下一组调整 |
| :--- | :--- | :--- |
| **轻松** | 速度下降 ≤ 5% | **+5%** |
| **正常** | 5% < 速度下降 ≤ 15% | **保持 (0%)** |
| **略疲劳** | 15% < 速度下降 ≤ 30% | **-5%** |
| **很疲劳** | 30% < 速度下降 ≤ 50% | **-10%** |

### 2.3 中途失败
> > *业务导读：如果没做完目标次数，说明太重了，下一组自动减负。*
> **条件**：目标次数未完成 (如目标10次只完成8次)。
> **排除**：用户手动跳过动作或跳过组数不触发。
> **调整**：**-5%** (下一组)

### 2.4 安全熔断机制 [新增]
> > *业务导读：不管算法怎么算，加重不能太猛，绝对值不能太离谱，安全底线必须守住。*
> **定义**：防止算法异常导致推荐重量过大，造成危险。
> **规则**：
> 1. **单次增幅限制**：无论算法如何计算，单次推荐重量增幅不得超过 `上一组重量` 的 30%。
> 2. **绝对值封顶**：
>    - 上肢孤立动作 (如弯举/侧平举)：推荐重量 ≤ 0.5 × 体重
>    - 除非用户 `运动等级` ≥ L4。

### 2.5 基于时长的负荷推荐 [新增]
> **场景**：在计时模式（如HIIT）下，使用力量模组（电机）进行训练。
> **逻辑**：重量必须降级以适配目标时长。时长越长，重量越轻。
> **公式**：
> 1. **估算次数**：`预估次数 = 目标时长(s) / 单次动作时长(s)` (若未知，默认3s/次)。
> 2. **查表适配**：根据 `预估次数` 查阅 [3.1 RM与百分比换算表] 得到 `适配RM%`。
> 3. **计算重量**：`推荐重量 = 用户1RM × 适配RM% × 意图强度(%)`。
> *注：此逻辑确保用户在规定时长内能维持动作，避免过早力竭。*

---

## 三、 基础数据表
> > *业务导读：算法计算所需的查表数据。*

### 3.1 RM与百分比换算表
> > *业务导读：把“最大重量”换算成“做10次的重量”，这是负荷计算的字典。*
> **用途**：将 1RM 转化为特定次数的训练重量。

| 次数 (Reps) | 1RM百分比 |
| :--- | :--- |
| **1** | 100% |
| **2** | 95% |
| **3** | 93% |
| **4** | 90% |
| **5** | 87% |
| **6** | 85% |
| **7** | 83% |
| **8** | 80% |
| **9** | 77% |
| **10** | 75% |
| **11** | 73% |
| **12** | 70% |
| **13** | 67% |
| **14** | 65% |
| **15** | 63% |
| **16** | 60% |

### 3.2 数据更新机制
> > *业务导读：练完立刻更新你的能力数据，让下一次推荐更准。*
> **触发时机**：每次训练/测评结束后。
> **更新对象**：
> 1. **动作1RM**：根据本次训练最大负荷反推更新。
> 2. **记忆重量**：更新为本次训练使用的正式组重量。
> 3. **上次运动时间**：更新为当前时间。

## 四、 附录：肌肉系数映射表
> > *业务导读：定义不同动作与核心部位力量的换算关系。*
> **定义**：基于[主动肌]反向映射的重量系数配置。
> **用途**：用于新动作冷启动时的重量推算。

| 体测动作 | 映射部位1RM | 主动肌 (Global Key) | 肌肉系数 |
| :--- | :--- | :--- | :--- |
| **交叉侧平举** | **肩部1RM** | 三角肌前束 | **1.2** |
| | | 三角肌中束 | **1.0** |
| | | 三角肌后束 | **0.7** |
| | | 肩袖肌群 | **0.5** |
| **二头弯举** | **手臂1RM** | 肱二头肌 | **1.0** |
| | | 肱三头肌 | **1.3** |
| **平板卧推** | **胸部1RM** | 胸大肌上束 | **0.8** |
| | | 胸大肌中束 | **1.0** |
| | | 胸大肌下束 | **1.1** |
| | | 胸大肌内束 | **0.6** |
| **俯身划船** | **背部1RM** | 上背 | **0.6** |
| | | 中背 | **1.0** |
| | | 下背 | **0.7** |
| **站姿上劈** | **核心1RM** | 腹直肌 | **0.7** |
| | | 腹斜肌 | **1.0** |
| **传统拉环深蹲** | **臀部1RM** | 臀大肌 | **1.0** |
| | | 臀中肌 | **0.5** |
| **传统拉环深蹲** | **腿部1RM** | 股四头肌 | **1.0** |
| | | 腘绳肌 | **1.1** |
| | | 内收肌 | **0.5** |
| | | 腓肠肌 | **0.6** |