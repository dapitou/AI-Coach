# 课程环节模板属性 —— 设计疑问点汇总

> 本文档用于梳理「课程环节模板属性」在设计阶段尚需明确的关键问题，  
> 以避免后续在运营配置、规则实现及 AI 生成行为上产生歧义。

---

## 一、模板id设计相关

当前「环节模板 ID」：
- 实际由系统自动生成
- **技术侧 ID 为纯数字，不带任何字母**
- 本质是系统内部唯一标识

但在产品定义中：
- 示例使用了类似 `TPL_SEG_001` 的**业务可读编号**
- 容易被理解为运营侧使用的“模板编号”

技术 ID 与业务编号在表达形式和使用场景上存在明显差异。

---

## 风险

- 纯数字 ID 不利于运营识别和沟通
- 产品文档示例与真实数据形态不一致，容易产生误解
- 后续版本管理时，编号语义不清晰

---

## 建议

- 继续使用**纯数字 ID**作为技术侧唯一标识（内部使用）
- 新增一个**带字母的模板编号 / Code**，用于业务侧展示与管理

**【评审回复】**
同意该建议。
1. **ID定义**：数据库里用自动生成的纯数字作为唯一标识，主要给系统内部关联数据用，不对外展示。
2. **业务编码**：额外加一个带字母的编号字段（template_code，如 `TPL_SEG_001`），专门给运营人员看，方便在后台管理和排查问题。PRD里说的“唯一标识符”指的就是这个业务编号。

---

## 二、基础属性匹配规则

- 「环节维度 + 环节目标」是否要求**唯一命中一个模板**？
- 是否允许多个模板同时匹配同一维度与目标？
- 若允许多个模板命中，如何选择最终模板？
- 从那几个维度可以确定唯一模版

**【评审回复】**
1. **匹配策略**：不需要只命中一个模板，系统会从符合条件的模板里挑一个最合适的。
2. **优先级算法**：如果找到好几个能用的模板，系统会按顺序给它们打分，分高的胜出：
   - **模板键**：必须完全一样才算匹配。
   - **目标**：完全一样的给高分，通用的（All）给低分，不一样的直接淘汰。
   - **等级**：完全一样的给高分，在兼容范围内的给低分，不一样的淘汰。
   - **性别**：完全一样的给高分，通用的（All）给低分。
3. **兜底逻辑**：如果最后分数一样，就选那个最近修改过的模板。

---

## 三、动作配比字段相关

- 「动作配比」是否只是**展示字段**，不参与任何业务逻辑？
- 是否要求该字段与实际权重配置**强一致**？
- 当权重配置不合法时，是否仍然生成动作配比？

**【评审回复】**
1. **字段性质**：这个字段只用来展示，不用来做计算。它是系统根据下面配置好的“动作槽位”自动算出来的比例字符串（如 `0.6:0.4`），方便在列表页一眼看清结构。
2. **一致性**：展示的比例必须和实际配置完全一致，保留一位小数。
3. **异常处理**：运营保存配置的时候，系统会检查权重加起来是不是等于1。如果不对，直接报错不让保存，这样就不会生成错误的配比字符串了。

---

## 、四、动作槽位

### 1. 槽位是否可重复

- 同一「侧重维度 + 侧重目标」是否允许配置多个动作槽位？
- 是否需要对动作槽位做唯一性约束？

### 2. 权重规则

- 所有动作槽位的权重之和：
  - 是否必须等于 1？
  - 还是只作为相对权重

- 是否允许权重为 0？
- 权重的业务语义是：
  - 严格比例？
  - 还是倾向性权重？

**【评审回复】**
1. **可重复性**：**允许重复配置**。比如你可以配置两个针对“胸部”的槽位，第一个占20%按难度排，第二个占80%随机排。
2. **权重规则**：
   - **归一化**：配置的时候最好加起来等于1（100%）。如果没对齐，系统会自动按比例换算。
   - **允许0吗**：**不允许**。如果权重是0，这个槽位就没意义了，应该直接删掉。
   - **语义**：代表**严格的数量比例**。
     - 比如总共10个动作，权重0.4就是4个动作。

### 3. 保底规则（如后续引入）

- 保底的含义是：
  - 最小占比？
  - 还是最少动作数量？

- 保底与权重之间是否存在大小约束关系？
- 当动作池不足时，保底如何兜底处理？

**【评审回复】**
1. **含义**：指的是**最少动作数量**。
2. **逻辑**：只要配置了这个槽位，不管权重算出来是多少，最少也得给它分配1个动作（除非整个环节一个动作都没有）。
3. **兜底**：如果动作库里动作不够填不满，会触发**“降级熔断机制”**，比如放宽筛选条件再找一次。
4. **溢出处理**：如果因为每个槽位都保底1个，导致总数超标了，系统会自动从权重最大的那个槽位里扣掉多出来的数量，保证总数不变。

---

## 五、排序策略相关

- 同一个「排序维度」是否允许在排序策略中重复出现？
- 若重复出现，后者是否覆盖前者，还是叠加生效？

- 排序策略是否严格按数组顺序作为执行优先级？
- 是否允许在排序链中插入「随机排序」？

- 自定义排序未覆盖的值如何处理？
- 自定义排序与后续排序规则是否会共同生效？

**【评审回复】**
1. **执行逻辑**：严格按照配置的顺序，一层一层往下排。比如先按“动作构造”排，如果构造一样，再按“难度”排。
2. **重复维度**：允许重复，但一般没必要。
3. **随机排序**：**允许**。通常放在最后一步，用来把前面条件都一样的动作打乱顺序，增加趣味性。
4. **未覆盖值**：如果自定义排序里没提到的值，就统一放到最后面（沉底处理）。

---

## 六、模板演进与兼容性

- 模板结构调整后，历史模板如何兼容？
- 模板修改后，是否影响已生成的课程？

**【评审回复】**
1. **快照机制**：课程一旦生成保存了，就像拍了张照片，里面的动作就固定下来了。以后就算模板改了，这张“照片”也不会变。
2. **生效时机**：修改模板只会影响**以后新生成**的课程，或者用户手动点击“重新生成”的时候。

---

## 其他：

1、动作类型、计次方式、电机配置、镜像视频时长、其他部位2、其他部位3、其他肌肉1、其他肌肉2、其他肌肉3是否是去掉，如果去掉，请补充默认值或逻辑
2、动作权重是否为新增字段，现有版本没有推荐值字段
3、动作功能是否为新增字段，现有版本没有功能标签字段
4、单侧双侧对应现有版本的是否双边字段吧
5、纠错反馈中的优先级是否还保留
6、封面图是否为新增字段，现有版本没有设备端封面图字段
7、单次动作时长是否为新增字段，现有版本没有该字段
8、现版本的动作介绍为富文本内容格式，是要改成普通文本输入
9、动作模式是字典值，现有字典和动作属性文档中不一致
10、动作属性中32、33项在prd中没有显现，麻烦确认

**【评审回复】**
1. **字段映射**：
   - `动作类型` (旧含义：热身/主训/放松) -> **已移除**。现在不再把动作死死绑在某个环节上，而是用 **`动作功能`** (如：激活、柔韧) 来区分职能，这样动作能复用得更好。
   - `计次方式` -> 对应新字段 `单侧/双侧`。
   - `电机配置` -> **已废弃**。现在由 `力量模组` (开关) 和环节里的 `发力模式` 一起控制。
   - `镜像视频时长` -> **复用主视频时长**（PRD里没定义单独的时长，默认和主视频一样）。
   - `其他部位` -> 对应新字段 `次要部位`。
   - `其他肌肉` -> 对应新字段 `辅助肌`。
   - 请以《动作属性.md》为准，旧数据迁移的时候需要清洗一下，填上默认值。
2. **动作权重**：确认是新增字段，用来给算法排序打底分（默认50分）。
3. **动作功能**：确认是新增字段，用来做跨部位的标签匹配。
4. **单侧双侧**：确认对应现有版本的`是否双边`。
5. **纠错优先级**：保留。虽然PRD没细说，但纠错算法还是需要这个优先级来决定先报哪个错。
6. **封面图**：确认新增，移动端和设备端要分开。PRD里叫 `课程封面图` / `动作封面图`。
7. **单次动作时长**：确认新增关键字段。**注意**：PRD定义它是**“自动计算”**出来的（`视频时长 / 演示次数`），但在数据库里要存下来，方便快速算课程总时长。
8. **动作介绍**：**保留富文本格式**。因为动作详情页可能要图文混排做深度教学展示。
9. **动作模式字典**：以**《动作属性.md》里的枚举值**为最新标准，请更新数据库字典。
10. **属性32/33**：**32. AI配置**和**33. 力量模组**在《动作属性.md》的“硬件与算法配置”章节里**明确写了**，请查阅一下。