# 计划生成逻辑 v1.0
> > *业务导读：第一版计划生成算法，简单直接，保证能生成一个可用的训练计划。*
> **版本定义**：基于“线性周期”模型，实现“傻瓜式”一键生成。
> **核心目标**：跑通[档案]->[计划]->[排期]全链路，确保计划逻辑自洽、安全可用。
> **适用阶段**：P1

## 核心架构 (简化版)
> > *业务导读：简化的决策流程，只保留最核心的步骤。*
> 沿用七层模型的前三层，去除复杂的动态调整逻辑。

## 第一层：用户输入 (对应架构：输入层)
> 任务：收集生成计划所需的关键约束条件。
> > *业务导读：收集你的基本信息（如身体素质）和约束条件（如每周练几天），就像教练在开课前进行的“摸底访谈”。*

### 计划参数设定
> > *业务导读：确定计划多长、每次练多久，这是计划的基本框架。*
> **计划周期**：1-24 [必填，数字输入，默认：4] -> 用途：决定计划的时间跨度，单位为周。
> **单课时长**：20-60 [必填，滑动条，默认：档案`每日运动时长`] -> 用途：作为后续生成课程的时间约束，单位为分钟。
> **单课环节**：热身 | 主训 | 放松 [必填，多选，默认：全选]
> **计划开始日期**：YYYY-MM-DD [必填，默认：今日] -> 用途：计划起止时间。

### 疲劳干预 (一级)
> > *业务导读：如果身体还没恢复好，系统会建议你晚点开始，或者降低强度，安全第一。*
> 引用：[4.1状态适配配置]
> **疲劳提示 (交互层)**：若用户当前全身或核心肌群处于[疲劳/力竭]状态，UI弹出提示：“检测到您身体尚未完全恢复，建议将计划开始日期推迟至[建议日期]”。
> **策略降级 (逻辑层)**：若用户坚持今日开始，后端强制将计划首周的`强度系数`下调（如 1.0 -> 0.8），以保障安全。

### 档案校验与读取
> > *业务导读：检查你的档案全不全，缺了身高体重没法算，缺了伤病记录不安全。*
> **逻辑**：检查 [运动档案] 完整性，若缺失强制引导补全。
> **关键字段**：`性别`、`生日`、`身高`、`体重`、`BMI`、`运动等级`、`主要目标`、`功能目标`、`运动等级`、`每周运动频率`、`每周训练日`、`疼痛部位`、`没有的器械`。

## 第二层：计划确认 (对应架构：第1层 计划)
> 任务：生成计划维度的基础属性。
> > *业务导读：确定大方向。是增肌还是减脂？是新手还是大神？先把整个计划的基调定下来。*

### 计划初始化
> > *业务导读：把你的目标（增肌/减脂）和等级（新手/大神）翻译成系统能懂的参数。*
> **目标匹配**：计划`计划目标` = 档案`主要目标`。
> **难度匹配**：计划`计划难度` = 档案`运动等级`。
> **周期模型**：强制锁定为 *线性周期* (MVP阶段)。

## 第三层：阶段确认 (对应架构：第2层 阶段)
> 任务：规划计划的时间轴和阶段策略。
> > *业务导读：把长计划切分成几个阶段。就像打游戏通关，先适应，再进阶，最后突破，中间还要安排休息周回血。*

### 阶段划分逻辑
> > *业务导读：根据计划长短，切分出适应、进阶、突破等不同阶段。*
> 引用：[2.3阶段周期分配配置]
> **标准模型**：适应期 → 进阶期 → 突破期 → 减载期。
> **短周期处理**：
> - 判断：若 计划`计划周期` < `短周期阈值`。
> - 逻辑：根据 档案`运动等级` 匹配 `短周期策略` 中的阶段组合。

### 阶段周期分配
> > *业务导读：算算每个阶段具体练几周，长计划阶段长，短计划阶段短。*
> 引用：[2.3阶段周期分配配置]
> 规则：按 `标准比例` 分配周数（四舍五入取整）。
> 兜底：若某阶段计算结果 < `阶段最小周数`，强制设为最小值。

### 阶段属性填充
> > *业务导读：给每个阶段定规矩，比如进阶期强度大点，减载期轻松点。*
> 引用：[1.1策略矩阵配置]
> **属性赋值**：
> - 阶段`阶段目标` = 计划`计划目标`。
> - 阶段`阶段类型` = 策略`阶段类型`。
> - 阶段`目标RPE` = 策略`目标RPE`。
> **训练配置初始化** (周期化修正)：
> - **逻辑**：根据 阶段`阶段类型` 获取对应的修正系数。
> - **执行**：应用配置中的 `强度系数` 和 `容量系数` 对基准参数进行修正。

## 第4层：单周循环模板匹配 (对应架构：第3层 单周循环模板)
> 任务：为每个阶段匹配最佳的周排课逻辑。
> 引用：[1.5 单周循环模板配置]
> > *业务导读：决定每周具体怎么练。是练三天休四天，还是推拉腿循环？给每一周找个最合适的“课程表模子”。*

### 模板选择
> > *业务导读：根据你的周频（一周练几天）和目标，选个最合适的课程表模板。*
> **筛选条件**：
> - 目标一致：模板`模板目标` = 计划`计划目标`。
> - 难度适配：模板`模板难度` = 计划`计划难度`。
> - 频率兼容：模板`模板周频` ≤ 档案`每周运动频率`。
> **决策策略**：
> - 最优解：优先选 模板`模板周频` 最接近 档案`每周运动频率` 的模板。
> - 兜底：若无匹配，降级匹配同目标下的最低频模板（通常为全身循环）。

### 排课实例化（周循环生成）
> > *业务导读：把模板里的“推力日”、“拉力日”填到具体的日期里，多出来的日子怎么练也安排好。*
> **训练日填充**：
> - 排期`训练日` = 档案`每周训练日`。
> - 排期`课程槽位` = 模板`基础槽位` (按序填充)。
> - **溢出处理** (当 档案`每周运动频率` > 模板`模板周频`)：
>   - 依据 模板`填充策略`：
>     - **循环**：排期`课程槽位` = 循环取用 模板`基础槽位`。
>     - **填充**：排期`课程槽位` = 取用 模板`填充槽位`。
>     - **随机**：排期`课程槽位` = 随机抽取 模板`基础槽位`。
> **休息日填充**：
> - 若 模板`休息日策略` == "主动恢复"：排期`休息日内容` = 模板`休息槽位`。
> - 若 模板`休息日策略` == "完全休息"：排期`休息日内容` = 空。

## 第五层：用户微调 (对应架构：交互层)
> 任务：允许用户对生成的计划进行个性化修改。
> > *业务导读：把控制权交给你。哪天练、练多久，如果不满意可以自己改，改完再生成。*

> **调整训练日**：周一 | ... | 周日 [选填，多选，默认：当前生成结果] -> 若天数不变，仅平移槽位；若天数改变，触发模板重新匹配。
> **调整单课时长**：20-60分钟 [选填，滑动条，默认：当前生成结果] -> 更新 计划`单课时长`，作为后续生成具体课程时的约束条件。
> **调整开始日期**：YYYY-MM-DD [选填，日期选择，默认：今日] -> 整体平移计划的时间轴，重新计算各阶段的起止日期。
> **重置计划**：点击触发 [选填，交互] -> 返回“第一层：用户输入”，允许修改约束条件后重新生成。
> **加入日程**：点击“加入计划” [必填，交互] -> 将生成的未来 N 周课表写入用户日历数据库，锁定当前计划 ID；若今日是训练日，立即生成今日课程。

---

## 异常处理
> > *业务导读：处理缺勤、中途修改等特殊情况的规则。*
### 缺勤处理
> > *业务导读：如果用户没来练，系统怎么处理过期的课程。*
> v1.0 暂不处理自动顺延。若用户缺勤，计划日期继续流逝，用户需手动点击历史日期的课程进行补练，或直接进行今日课程。
### 中途修改
> > *业务导读：如果用户中途想改训练时间，系统如何响应。*
> 支持用户修改“每周训练日”，系统仅重新映射未来的日期，不改变已生成的课程内容。

---

## 迭代规划
> > *业务导读：未来的升级路线图，从简单的排期工具进化为智能教练。*

### v1.0 (当前)
> > *业务导读：当前版本的能力边界，主要解决“有计划可练”的问题。*
> **核心能力**：基于“线性周期”的静态规划 + 基础模板匹配。
> **数据积累**：积累用户对不同周频、时长的接受度数据。
> **局限性**：计划生成后即固定，无法随用户进步速度动态调整阶段长度。

### v2.0 (进阶 - 智能助理)
> > *业务导读：下一版将引入动态调整，让计划更灵活。*
> **能力升级**：
> - **波浪周期**：引入非线性周期模型，针对高阶用户 (L3+) 提供强度波动方案。
> - **双向动态排期**：
>   - **行为影响计划**：基于 RPE 和完成度，动态调整后续阶段的强度系数。
>   - **计划驱动日程**：支持计划变更实时同步至用户日历。

### v3.0 (完整 - 专家系统)
> > *业务导读：最终版将具备专家级的干预能力，处理复杂场景。*
> **能力升级**：
> - **平台期干预**：识别训练停滞，自动插入“冲击周”或“减载周”。
> - **智能回归**：缺勤 > 3天后，自动触发“顺延”或“降级”策略。
> - **生理周期适配**：基于女性生理周期，自动调整计划中的强度波动节奏。