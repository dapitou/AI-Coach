# 计划生成逻辑
> 定义：基于用户长期目标，生成多阶段、周期化的训练计划核心算法。
> 架构：用户输入 -> 计划确认 -> 阶段确认 -> 单周循环模板匹配 -> 用户微调

## 第一层：用户输入 (对应架构：输入层)
> 任务：收集生成计划所需的关键约束条件。
> > *业务导读：收集你的基本信息（如身体素质）和约束条件（如每周练几天），就像教练在开课前进行的“摸底访谈”。*

### 计划参数设定
> > *业务导读：确定计划多长、每次练多久，这是计划的基本框架。*
> **计划周期**：1-24 [必填，数字输入，默认：4] -> 用途：决定计划的时间跨度，单位为周。
> **单课时长**：20-60 [必填，滑动条，默认：档案`每日运动时长`] -> 用途：作为后续生成课程的时间约束，单位为分钟。
 > **单课环节**：热身 | 主训 | 放松 [必填，多选，默认：全选]
 > **计划开始日期**：YYYY-MM-DD [必填，默认：今日] -> 用途：计划起止时间。

### 疲劳干预 (一级)
> > *业务导读：如果身体还没恢复好，系统会建议你晚点开始，或者降低强度，安全第一。*
> 引用：[4.1状态适配配置]
> **疲劳提示**：若用户当前全身或核心肌群处于[疲劳/力竭]状态，提示：“检测到您身体尚未完全恢复，推荐将计划开始日期推迟至[推荐日期]”。
> **策略降级**：若用户坚持今日开始，后端推荐将 `计划.首周强度系数` 下调（如 1.0 -> 0.8），作为推荐方案。

### 档案校验与读取
> > *业务导读：检查你的档案全不全，缺了身高体重没法算，缺了伤病记录不安全。*
> **逻辑**：检查 [运动档案] 完整性，若缺失强制引导补全。
> **关键字段**：`性别`、`生日`、`身高`、`体重`、`BMI`、`运动等级`、`主要目标`、`功能目标`、`运动等级`、`每周运动频率`、`每周训练日`、`疼痛部位`、`没有的器械`。

## 第二层：计划确认 (对应架构：第1层 计划)
> 任务：生成计划维度的基础属性。
> > *业务导读：确定大方向。是增肌还是减脂？是新手还是大神？先把整个计划的基调定下来。*

### 计划初始化
> > *业务导读：把你的目标（增肌/减脂）和等级（新手/大神）翻译成系统能懂的参数。*
> **类型设定**：
> - `计划.计划类型` = "用户生成"。
> **目标匹配**：
> - `计划.计划目标` = `档案.主要目标`。
> - `计划.计划功能目标` = `档案.功能目标`。
> **难度定级**：
> - `计划.计划难度` = `档案.运动等级`。
> **周期确认**：
> - `计划.计划周期` = `用户输入.计划周期`。

## 第三层：阶段确认 (对应架构：第2层 阶段)
> 任务：规划计划的时间轴和阶段策略。
> > *业务导读：把长计划切分成几个阶段。就像打游戏通关，先适应，再进阶，最后突破，中间还要安排休息周回血。*

### 阶段划分逻辑
> > *业务导读：根据计划长短，切分出适应、进阶、突破等不同阶段。*
> 引用：[2.3阶段周期分配配置]
> **标准模型**：适应期 → 进阶期 → 突破期 → 减载期。
> **短周期处理**：
> - **判断**：若 `计划.计划周期` < `配置.短周期阈值`。
> - **逻辑**：匹配 `短周期策略` (依据: `档案.运动等级`)。

### 阶段周期分配
> > *业务导读：算算每个阶段具体练几周，长计划阶段长，短计划阶段短。*
> 引用：[2.3阶段周期分配配置]
> **规则**：按 `标准比例` 分配周数（四舍五入取整，且 ≥ 阶段最小周数）。
> **兜底**：若总周数溢出，优先扣除最长阶段（通常为进阶期）。
> *注：此为初始规划，实际执行中应根据用户RPE反馈动态调整阶段长度（如提前进入平台期则提前结束进阶期）。*

### 阶段属性填充
> > *业务导读：给每个阶段定规矩，比如进阶期强度大点，减载期轻松点。*
> 引用：[2.3阶段周期分配配置]
> **属性赋值**：
> - `阶段.阶段目标` = `计划.计划功能目标`。
> **训练配置初始化** (周期化修正)：
> - **逻辑**：读取 `修正系数` (依据: `阶段.阶段类型`)。
> - **执行**：应用 `强度系数` & `容量系数`。

## 第4层：单周循环模板匹配 (对应架构：第3层 单周循环模板)
> 任务：为每个阶段匹配最佳的周排课逻辑。
> 引用：[1.5 单周循环模板配置]
> > *业务导读：决定每周具体怎么练。是练三天休四天，还是推拉腿循环？给每一周找个最合适的“课程表模子”。*

### 模板选择
> > *业务导读：根据你的周频（一周练几天）和目标，选个最合适的课程表模板。*
> **筛选条件**：
> - 目标一致：`模板.模板目标` == `计划.计划功能目标`。
> - 难度适配：`模板.模板难度` == `计划.计划难度`。
> - 频率兼容：`模板.模板周频` ≤ `档案.每周运动频率`。
> **决策策略**：
> - 最优解：选择模板 (条件: `Min(|模板.模板周频 - 档案.每周运动频率|)`)。
> - 兜底：若无匹配 → 降级匹配 `最低频模板`。

### 排课实例化（周循环生成）
> > *业务导读：把模板里的“推力日”、“拉力日”填到具体的日期里，多出来的日子怎么练也安排好。*
> **训练日填充**：
> - `排期.训练日` = `档案.每周训练日`。
> - `排期.课程槽位` = `模板.基础槽位` (按序填充)。
> - **溢出处理** (当 `档案.每周运动频率` > `模板.模板周频`)：
>   - 依据 `模板.补充策略` (循环/补充/随机) 生成额外槽位。
> **休息日填充**：
> - 若 `模板.休息日策略` == "主动恢复" → `排期.休息日内容` = `模板.休息槽位`。

## 第五层：用户微调 (对应架构：交互层)
> 任务：允许用户对生成的计划进行个性化修改。
> > *业务导读：把控制权交给你。哪天练、练多久，如果不满意可以自己改，改完再生成。*

> **调整训练日**：更新 `档案.每周训练日` → 若天数不变，平移槽位；若天数改变，触发 `模板重新匹配`。
> **调整单课时长**：更新 `计划.单课时长` → 约束后续课程生成。
> **调整开始日期**：更新 `计划.开始日期` → 平移 `计划时间轴`。
> **重置计划**：触发 `重置` → 返回 `用户输入`。

## 第六层：数据装配 (对应架构：输出层)
> 任务：实例化为标准的计划数据对象。
> 目标：确保数据与《计划属性》定义完美对应。
> > *业务导读：数据格式化与打包，准备输出给前端。*

### 字段填充
> > *业务导读：把算好的数据打包成前端能看懂的格式。*
> **基础信息**：生成 `计划ID`、`计划名称`、`计划介绍`。
> **结构组装**：
> - 将 `排期表` 嵌套入对应的 `阶段`。
> - 将 `阶段` 嵌套入 `计划`。
> **输出**：完整的 JSON 计划对象。

## 需求池
> > *业务导读：未来版本规划的逻辑模块。*
1. **周期模型选择**：支持波浪周期、区块周期等高阶模型。
2. **生理周期适配**：基于女性生理周期（月经期/卵泡期/排卵期/黄体期）自动调整训练强度、容量及动作禁忌。