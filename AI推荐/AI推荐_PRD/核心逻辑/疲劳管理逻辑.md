# 肌肉疲劳监控逻辑

## 核心架构
> 将部位-肌肉疲劳反应抽象为“部位-肌肉状态管理”。
- 状态值：所有肌肉/部位的满状态值均为 100（初始化/上限），彻底力竭为 0（下限）
- 核心逻辑：
  - 训练中：[训练容量] -> [肌肉状态值更新（下降）] -> [部位状态值更新（下降）]
  - 休息时：[从训练结束开始] -> [肌肉状态值更新（回升）] -> [部位状态值更新（回升）]
- 个性化：通过配置不同肌群的“疲劳敏感度”和“恢复速率”来体现生理差异。
    
## 数据定义
- **肌肉状态值**：数字 [0-100，精度：0.1]
- **部位状态值**：数字 [0-100，精度：0.1]
> 数据关系：部位状态值是对应部位下所有肌肉状态值的加权平均
- **肌肉疲劳敏感度**：数字 []
> 定义：承受单位负荷(如100kg)时，该肌肉状态值下降的快慢。
> 原理：小肌群(如肩/臂)对容量更敏感，大肌群(如腿/背)耐受度更高。*
- **肌肉恢复速率**：
> 定义：自然休息时，每小时状态值上升的数值 (单位：状态值/h)。
> 原理：姿态维持肌(如核心/小腿)供血好恢复快，爆发型大肌群(如胸/大腿)恢复慢。*
---
静态配置表 (生理学参数校对)
> 此表反映了不同肌群的生理特性（如快/慢肌纤维比例、横截面积大小）。

[部位：胸部]
- 权重分配：胸大肌中束(40%) + 上束(40%) + 下束(10%) + 内侧(10%)
- 疲劳敏感度：1.0 (基准)
- 恢复速率：1.5 (状态值/小时)
  
[部位：背部]
- 权重分配：背阔肌/中背(50%) + 上背/斜方肌(30%) + 下背/竖脊肌(20%)
- 疲劳敏感度：1.0 (基准)
- 恢复速率：1.5 (状态值/小时) (注：下背部单独设为 1.0，恢复极慢)
  
[部位：腿部]
- 权重分配：股四头肌(40%) + 腘绳肌(40%) + 臀部(20%)
- 疲劳敏感度：0.6 (大肌群耐受度极高，状态值下降慢)
- 恢复速率：1.2 (状态值/小时) (大肌群代谢废物清除慢)
  
[部位：肩部]
- 权重分配：三角肌中束(50%) + 前束(30%) + 后束(20%)
- 疲劳敏感度：1.5 (小肌群，对容量非常敏感)
- 恢复速率：2.0 (状态值/小时) (血液循环较好)
  
[部位：手臂]
- 权重分配：肱三头肌(60%) + 肱二头肌(40%)
- 疲劳敏感度：1.8 (小肌群，极易力竭)
- 恢复速率：2.0 (状态值/小时)
  
[部位：核心]
- 权重分配：腹直肌(70%) + 腹斜肌(30%)
- 疲劳敏感度：0.5 (耐力型肌纤维，极其耐造)
- 恢复速率：3.0 (状态值/小时) (恢复极快)
  

---
场景 A：训练结束结算 (状态值下降逻辑)
触发时机：用户结束训练时。

- 步骤一：计算训练容量
  - 力量训练：总容量 = 负荷(kg) × 次数 × 组数
  - 非力量训练：参考附录 MET 公式换算为虚拟容量
    
- 步骤二：肌肉状态值更新 (逐个肌肉计算)
 遍历该动作涉及的所有肌肉（包含主动肌和辅助肌）。
   
- 计算公式：
 肌肉状态下降值 = (总容量 ÷ 500) × 强度疲劳系数 × 疲劳敏感度 × 个体易疲劳系数 × 肌肉角色系数
   
- 执行更新：
 肌肉状态值（新） = 肌肉当前状态值 - 肌肉状态下降值（下降到0停止）
  
   > 参数详解：
   > - 基准锚点 (500)：设定每500kg容量为1个标准消耗单位。
   > - 强度疲劳系数：
   >   - < 60% 1RM (耐力/恢复): 0.8 [低机械张力，低损伤]
   >   - 60% - 85% 1RM (肌肥大): 1.0 [基准]
   >   - > 85% 1RM (力量/爆发): 1.3 [高机械张力，高微损伤]
   > - 肌肉角色系数：主动肌=100%，辅助肌=50%。
  
1. 步骤三：部位疲劳状态更新 (聚合)
基于最新的肌肉状态值，重新计算部位整体状态。此结果作为后续恢复的基准线。
  计算公式：
  部位当前状态值 = Σ (下属各肌肉新状态值 × 该肌肉在部位中的权重)
  

---
场景 B：不训练/自然恢复 (状态值上升逻辑)
触发时机：用户结束训练时，为恢复的开始。
- 步骤一：获取恢复时长
 计算距离上一次状态更新过去了多少小时 (h)。
- 步骤二：肌肉状态值恢复 (逐个肌肉计算)
 计算公式：
  - 肌肉状态值上升 = 恢复时长 × 肌肉恢复速率 × (1 + 睡眠修正 + 年龄修正) × 个体恢复效率系数
  执行更新：
  - 肌肉新状态值 = 肌肉旧状态值 + 肌肉状态上升值
3. 步骤三：部位疲劳状态更新 (决策依据)
依据恢复后的肌肉状态，重新计算部位状态值，用于推荐算法判断。
  
  计算公式：
  - 部位当前状态值 = Σ (下属各肌肉新状态值 × 该肌肉在部位中的权重)

---
五、 个体差异修正系数
用于修正上述公式中的“个体易疲劳系数”和“恢复效率系数”。

1. 易疲劳系数 (影响状态值下降幅度)
  - 标准值：1.0
  - 修正：
    - 女性：1.1 (同绝对容量下，疲劳感略强)
    - 新手：1.3 (神经适应差，容易力竭)
    - 高手：0.8 (耐受度高)
      
2. 恢复效率系数 (影响状态值上升速度)
  - 标准值：1.0
  - 修正：
    - 年龄 > 35：0.9
    - 年龄 > 50：0.8
    - 睡眠不足 (<6h)：-0.3 (扣减)
    - 睡眠充足 (>8h)：+0.2 (加成)
    - 高手：1.2
    - 压力大 (主观疲劳>7)：-0.2
      

---
部位状态更新
根据场景 B 计算出的“部位当前状态值”决定排课策略。

[状态值 85 - 100 🟢 满状态]
- 策略：高强度/突破
- 允许：1RM测试、爆发力训练、大容量复合动作。
  
[状态值 55 - 84 🟡 恢复中]
- 策略：中等/维持
- 允许：常规肌肥大训练(8-12RM)、器械固定轨迹训练。
- 警告：避免力竭组。
  
[状态值 30 - 54 🟠 疲劳]
- 策略：降阶/辅助
- 允许：小重量孤立动作、泵感训练。
- 禁止：作为复合动作的主动肌 (如腿部疲劳时禁止深蹲)。
  
[状态值 0 - 29 🔴 力竭]
- 策略：禁练
- 允许：仅限拉伸、筋膜放松、低强度有氧(LISS)。
  

---
附录：非力量训练虚拟容量换算 (MET 通用公式)
利用代谢当量 (MET) 将所有有氧/体能类训练统一折算为“虚拟容量(kg)”。

1. 通用换算公式
虚拟容量 = 动作MET值 × 时长(分钟) × 体重(kg) × 0.5
  
  > 系数说明 (0.5):
  > 用于平衡有氧耐力消耗与力量训练容量锚点(500kg)之间的关系。
  > 确保高强度有氧训练能产生合理的肌肉疲劳扣分。
  > *注：未来版本将引入基于心率区间(HR Zone)的 TRIMP (Training Impulse) 算法进行更精准计算。*