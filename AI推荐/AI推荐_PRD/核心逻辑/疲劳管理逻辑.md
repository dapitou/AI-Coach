# 肌肉状态管理逻辑 (原：疲劳管理)
> **定义**：像管理“电池电量”一样管理肌肉状态。训练会消耗电量，休息会充电。
> **架构**：基础配置 -> 训练消耗(耗电) -> 休息恢复(充电) -> 个体修正 -> 状态判定

## 核心概念
> **肌肉状态值**：0 (彻底累趴) - 100 (满血复活) - 105 (状态爆棚/超量恢复)。
> **部位状态值**：一个部位（如胸部）包含多块肌肉，它的状态是这些肌肉状态的平均分。
> **核心流转**：
> - **训练时**：累积训练量 -> 状态值下降 (实时扣减)。
> - **休息时**：时间流逝 -> 状态值回升 (按需计算，不实时刷新)。

## 第一层：基础参数配置 (对应架构：静态层)
> 任务：定义不同肌肉“抗造”程度和“回血”速度。
> **疲劳敏感度**：肌肉有多容易累。数值越高，同样的训练下掉血越快（小肌群通常更脆弱）。
> **恢复速率**：休息时回血有多快。数值代表每小时恢复多少点状态值。

### 部位参数表
| 部位 | 权重分配 (肌肉构成) | 疲劳敏感度 (易累程度) | 恢复速率 (回血速度) | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **胸部** | 胸大肌中束(40%), 上束(40%), 下束(10%), 内侧(10%) | 1.0 (基准) | 1.5 | - |
| **背部** | 背阔肌(50%), 斜方肌(30%), 竖脊肌(20%) | 1.0 (基准) | 1.5 | 下背部恢复较慢 |
| **腿部** | 股四头肌(40%), 腘绳肌(40%), 臀部(20%) | 0.6 (耐受/抗造) | 1.2 | 大肌群代谢慢 |
| **肩部** | 三角肌中束(50%), 前束(30%), 后束(20%) | 1.5 (敏感) | 2.0 | 小肌群 |
| **手臂** | 肱三头肌(60%), 肱二头肌(40%) | 1.8 (敏感) | 2.0 | 极易力竭 |
| **核心** | 腹直肌(70%), 腹斜肌(30%) | 0.5 (耐受) | 3.0 | 恢复极快 |

## 第二层：训练消耗逻辑 (对应架构：训练层)
> 任务：计算练一次会消耗多少“电量”。
> **触发时机**：用户完成并保存一次训练时。

### 步骤一：计算训练总量
> **力量训练**：`总负荷 = 重量(kg) × 次数 × 组数`
> **非力量训练**：`虚拟负荷 = 动作MET值 × 时长(min) × 体重(kg) × 0.5`

### 步骤二：计算肌肉消耗值 (逐个肌肉计算)
> **遍历范围**：该动作涉及的所有肌肉（包含主要发力肌和辅助肌）。
> **计算公式**：
> `肌肉消耗值 = (总负荷 ÷ 500) × 强度系数 × 节奏系数 × 疲劳敏感度 × 个体易疲劳系数 × 参与度系数`

> **参数详解**：
> - **基准锚点 (500)**：设定每搬运500kg重量为1个标准消耗单位。
> - **强度系数** (重量越重越累)：
>   - < 60% 1RM (耐力): 0.8
>   - 60% - 85% 1RM (肌肥大): 1.0 [基准]
>   - > 85% 1RM (力量): 1.3 [大重量]
> - **节奏系数** (动作越慢越累/TUT影响)：
>   - 慢速离心 (慢放): 1.2
>   - 常规节奏: 1.0
>   - 爆发力 (快起): 0.9
> - **参与度系数**：主动肌=100%，辅助肌=50%。

### 步骤三：执行更新
> `肌肉新状态 = MAX(0, 当前状态 - 消耗值)` (最低减到0)
> `部位新状态 = 所有下属肌肉状态的加权平均`

## 第三层：休息恢复逻辑 (对应架构：恢复层)
> 任务：计算休息期间“回血”了多少。
> **触发时机**：当需要查看状态或生成课程时（按需计算，而非后台每秒刷新）。

### 步骤一：计算休息时长
> `休息小时数 = (当前时间 - 上次更新时间) / 3600`

### 步骤二：计算分阶段回血值
> **核心逻辑**：恢复不是匀速的，刚练完恢复快，中间慢，最后可能超量恢复。
> **分段计算**：将 `休息小时数` 切分到以下区间，分别计算后求和。

 | 阶段 | 时间区间 | 速率倍率 | 生理意义 |
 | :--- | :--- | :--- | :--- |
 | **第一阶段** | 0 - 6h | **1.8x** | 快速回血期 (吃顿饭就回血) |
 | **第二阶段** | 6 - 24h | **0.7x** | 酸痛期 (DOMS高峰，恢复变慢) |
 | **第三阶段** | 24 - 72h | **1.2x** | 超量恢复期 (状态可能超过100) |
 | **第四阶段** | > 72h | **1.0x** | 归位期 (慢慢回到100) |

### 步骤三：更新与快照
> `肌肉新状态 = 旧状态 + 回血值`
> **上下限**：下限 0，上限 100
> **更新频率**：每小时更新一次

## 第四层：个体差异修正 (对应架构：适配层)
> 任务：根据用户体质调整参数（因人而异）。

### 1. 易疲劳程度
> **作用**：调整消耗的速度（标准值：1.0）。

| 条件 | 修正值 | 说明 |
| :--- | :--- | :--- |
| **女性** | 1.1 | 稍微容易累一点 |
| **新手 (L1/L2)** | 1.3 | 身体不适应，很容易累 |
| **高手 (L4/L5)** | 0.8 | 很耐造，不容易累 |

### 2. 恢复能力
> **作用**：调整回血的速度（标准值：1.0）。

| 条件 | 修正值 | 说明 |
| :--- | :--- | :--- |
| **年龄 > 35** | 0.9 | - |
| **年龄 > 50** | 0.8 | - |
| **睡眠不足 (<6h)** | -0.3 | 睡不够，恢复慢 |
| **睡眠充足 (>8h)** | +0.2 | 睡得好，恢复快 |
| **高手 (L4/L5)** | 1.2 | 身体底子好，恢复快 |
| **压力大** | -0.2 | 心累也会影响身体恢复 |

## 第五层：状态判定与建议 (对应架构：应用层)
> 任务：根据当前电量，决定能练什么。

### 状态映射表
| 状态区间 | 状态标签 | 策略建议 | 允许/禁止 |
| :--- | :--- | :--- | :--- |
| 85 - 100 | 🟢 已恢复 | **高强度训练** | 建议：正常练，可以做爆发力、大重量 |
| 55 - 84 | 🟡 恢复中 | **中等强度** | 建议：常规训练，不要练到力竭 |
| 30 - 54 | 🟠 疲劳中 | **降级/辅助** | 建议：小重量，练练泵感；禁止：做大重量深蹲/硬拉 |
| 0 - 29 | 🔴 已力竭 | **休息/放松** | 建议：拉伸、按摩、散步；禁止：力量训练 |